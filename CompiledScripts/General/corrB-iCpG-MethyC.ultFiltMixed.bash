#!/bin/bash
#SBATCH --time=34:00
#SBATCH --mem=6GB
#SBATCH -p short
# Set number of nodes to run
#SBATCH --nodes=1
# Set number of tasks to run
#SBATCH --ntasks=1
# Set number of cores per task (default is 1)
#SBATCH --cpus-per-task=18
# Output and error files
#SBATCH -o job.%J.out

source activate Genomics

rm -r /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands
mkdir /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands
mkdir /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes
mkdir /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed
mkdir /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared
mkdir /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out

#Annotating CpG Islands
CHROMOSOMES=`awk '{print $1}' /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/Bismark/MethylationBed/Genome/Abel-GCF_001522545.3_Parus_major1.1_genomic.chrom.genome`

for c in $CHROMOSOMES
do
grep "^$c" /work/mjuswilc/Domain/GreatTits/General/Annotations/Abel/CpG-Islands/GCF_001522545.3_Parus_major1.1_genomic-CpG.gff | awk -v chromosome=$c 'BEGIN{OFS=FS="\t"; CpG=0}{CpG=CpG+1; print $1 OFS $4 OFS $5 OFS chromosome"_"CpG}' > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes/$c-Abel-GCF_001522545.3_Parus_major1.1_genomic-CpG.bed &
JOBS=`jobs -l | grep -c '^\['`
while [ $JOBS -ge 18 ]
do
sleep 3s
JOBS=`jobs -l | grep -c '^\['`
done
done
wait


function CpG_Archipelago {
for c in $CHROMOSOMES
do
BRAINhDEPTH=`awk -v chrom=$c '$1==chrom{print int(($3*2)+0.5); exit}' /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/DepthFinder/gtSub_0.chrom-depth.txt`
BRAINlDEPTH=`awk -v chrom=$c '$1==chrom{print int(($3*0.5)+0.5); exit}' /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/DepthFinder/gtSub_0.chrom-depth.txt`
BLOODhDEPTH=`awk -v chrom=$c '$1==chrom{print int(($3*2)+0.5); exit}' /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/DepthFinder/gtSub_100.chrom-depth.txt`
BLOODlDEPTH=`awk -v chrom=$c '$1==chrom{print int(($3*0.5)+0.5); exit}' /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/DepthFinder/gtSub_100.chrom-depth.txt`
bedtools intersect -sorted -f 1 -wo -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/Outputs/DeconvolutedBrain/CpG/$P/mAbel-BrainMix.Blood-$P.$c.deduplicated.bismark.deconvoluted-brain-cov.CpG.bed.gz -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes/$c-Abel-GCF_001522545.3_Parus_major1.1_genomic-CpG.bed | awk -v hBRAIN=$BRAINhDEPTH -v lBRAIN=$BRAINlDEPTH  -v hBLOOD=$BLOODhDEPTH -v lBLOOD=$BLOODlDEPTH 'BEGIN{OFS=FS="\t"}($8+$9)>hBRAIN || ($8+$9)<lBRAIN{next}($11+$12)>hBLOOD || ($11+$12)<lBLOOD{next}{print $0}' | uniq | awk 'BEGIN{OFS=FS="\t"}NR==1{Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=1; next}CpG!=$23{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG; Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=$4; DeconMethReads=$5; DeconUnmethReads=$6; BrainMethProportion=$7; BrainMethReads=$8; BrainUnmethReads=$9; BloodMethProportion=$10; BloodMethReads=$11; BloodUnmethReads=$12; MixMethProportion=$13; MixMethReads=$14; MixUnmethReads=$15; tpMethProportion=$16; tpMethReads=$17; tpUnmethReads=$18; P=$19; CpG=$23; count=1; next}{Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=count+1}END{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG}' >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed
bedtools intersect -sorted -f 1 -wo -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/Outputs/DeconvolutedBrain/nCpG/$P/mAbel-BrainMix.Blood-$P.$c.deduplicated.bismark.deconvoluted-brain-cov.nCpG.bed.gz -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes/$c-Abel-GCF_001522545.3_Parus_major1.1_genomic-CpG.bed | awk -v hBRAIN=$BRAINhDEPTH -v lBRAIN=$BRAINlDEPTH  -v hBLOOD=$BLOODhDEPTH -v lBLOOD=$BLOODlDEPTH 'BEGIN{OFS=FS="\t"}($8+$9)>hBRAIN || ($8+$9)<lBRAIN{next}($11+$12)>hBLOOD || ($11+$12)<lBLOOD{next}{print $0}' | uniq | awk 'BEGIN{OFS=FS="\t"}NR==1{Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=1; next}CpG!=$23{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG; Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=$4; DeconMethReads=$5; DeconUnmethReads=$6; BrainMethProportion=$7; BrainMethReads=$8; BrainUnmethReads=$9; BloodMethProportion=$10; BloodMethReads=$11; BloodUnmethReads=$12; MixMethProportion=$13; MixMethReads=$14; MixUnmethReads=$15; tpMethProportion=$16; tpMethReads=$17; tpUnmethReads=$18; P=$19; CpG=$23; count=1; next}{Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=count+1}END{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG}' >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed

bedtools intersect -sorted -f 1 -wo -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/Outputs/DeconvolutedBrain/CpG/$P/mAbel-BrainMix.Blood-$P.$c.deduplicated.bismark.deconvoluted-brain-cov.CpG.bed.gz -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes/$c-Abel-GCF_001522545.3_Parus_major1.1_genomic-CpG.bed | awk -v hBRAIN=$BRAINhDEPTH -v lBRAIN=$BRAINlDEPTH  -v hBLOOD=$BLOODhDEPTH -v lBLOOD=$BLOODlDEPTH 'BEGIN{OFS=FS="\t"}($8+$9)>hBRAIN || ($8+$9)<lBRAIN{next}($11+$12)>hBLOOD || ($11+$12)<lBLOOD{next}($8/($8+$9))>=0.1 || ($11/($11+$12))>=0.1{print $0}' | uniq | awk 'BEGIN{OFS=FS="\t"}NR==1{Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=1; next}CpG!=$23{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG; Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=$4; DeconMethReads=$5; DeconUnmethReads=$6; BrainMethProportion=$7; BrainMethReads=$8; BrainUnmethReads=$9; BloodMethProportion=$10; BloodMethReads=$11; BloodUnmethReads=$12; MixMethProportion=$13; MixMethReads=$14; MixUnmethReads=$15; tpMethProportion=$16; tpMethReads=$17; tpUnmethReads=$18; P=$19; CpG=$23; count=1; next}{Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=count+1}END{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG}' >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed
bedtools intersect -sorted -f 1 -wo -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/Outputs/DeconvolutedBrain/nCpG/$P/mAbel-BrainMix.Blood-$P.$c.deduplicated.bismark.deconvoluted-brain-cov.nCpG.bed.gz -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Chromosomes/$c-Abel-GCF_001522545.3_Parus_major1.1_genomic-CpG.bed | awk -v hBRAIN=$BRAINhDEPTH -v lBRAIN=$BRAINlDEPTH  -v hBLOOD=$BLOODhDEPTH -v lBLOOD=$BLOODlDEPTH 'BEGIN{OFS=FS="\t"}($8+$9)>hBRAIN || ($8+$9)<lBRAIN{next}($11+$12)>hBLOOD || ($11+$12)<lBLOOD{next}($8/($8+$9))>=0.1 || ($11/($11+$12))>=0.1{print $0}' | uniq | awk 'BEGIN{OFS=FS="\t"}NR==1{Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=1; next}CpG!=$23{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG; Chromosome=$1; Position=$2; Position2=$3; DeconMethProportion=$4; DeconMethReads=$5; DeconUnmethReads=$6; BrainMethProportion=$7; BrainMethReads=$8; BrainUnmethReads=$9; BloodMethProportion=$10; BloodMethReads=$11; BloodUnmethReads=$12; MixMethProportion=$13; MixMethReads=$14; MixUnmethReads=$15; tpMethProportion=$16; tpMethReads=$17; tpUnmethReads=$18; P=$19; CpG=$23; count=1; next}{Position2=$3; DeconMethProportion=DeconMethProportion+$4; DeconMethReads=DeconMethReads+$5; DeconUnmethReads=DeconUnmethReads+$6; BrainMethProportion=BrainMethProportion+$7; BrainMethReads=BrainMethReads+$8; BrainUnmethReads=BrainUnmethReads+$9; BloodMethProportion=BloodMethProportion+$10; BloodMethReads=BloodMethReads+$11; BloodUnmethReads=BloodUnmethReads+$12; MixMethProportion=MixMethProportion+$13; MixMethReads=MixMethReads+$14; MixUnmethReads=MixUnmethReads+$15; tpMethProportion=tpMethProportion+$16; tpMethReads=tpMethReads+$17; tpUnmethReads=tpUnmethReads+$18; P=$19; CpG=$23; count=count+1}END{print Chromosome OFS Position OFS Position2 OFS count OFS DeconMethProportion/count OFS DeconMethReads OFS DeconUnmethReads OFS BrainMethProportion/count OFS BrainMethReads OFS BrainUnmethReads OFS BloodMethProportion/count OFS BloodMethReads OFS BloodUnmethReads OFS MixMethProportion/count OFS MixMethReads OFS MixUnmethReads OFS tpMethProportion/count OFS tpMethReads OFS tpUnmethReads OFS P OFS CpG}' >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed
done
}
for P in 0 10 20 30 40 50 60 70 80 90 100
do
rm /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed
rm /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed
CpG_Archipelago &
done
wait

bedtools intersect -sorted -f 1 -F 1 -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-0.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-10.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-20.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-30.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-40.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-50.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed |  bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-60.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-70.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-80.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-90.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-100.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | awk 'BEGIN{OFS=FS="\t"}{print $1 OFS $2 OFS $3}' | uniq > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed

bedtools intersect -sorted -f 1 -F 1 -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-0.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-10.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-20.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-30.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-40.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-50.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed |  bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-60.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-70.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-80.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-90.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-100.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | awk 'BEGIN{OFS=FS="\t"}{print $1 OFS $2 OFS $3}' | uniq > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed

bedtools intersect -sorted -f 1 -F 1 -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-0.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-10.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-20.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-30.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-40.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-50.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed |  bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-60.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-70.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-80.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-90.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-100.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | awk 'BEGIN{OFS=FS="\t"}{print $1 OFS $2 OFS $3}' | uniq > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed

bedtools intersect -sorted -f 1 -F 1 -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-0.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-10.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-20.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-30.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-40.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-50.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed |  bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-60.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-70.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-80.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-90.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | bedtools intersect -sorted -f 1 -F 1 -a - -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-100.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | awk 'BEGIN{OFS=FS="\t"}{print $1 OFS $2 OFS $3}' | uniq > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed

echo -e 'Chromosome\tPosition\tPosition2\tSites\tDeconMethProportion\tDeconMethReads\tDeconUnmethReads\tBrainMethProportion\tBrainMethReads\tBrainUnmethReads\tBloodMethProportion\tBloodMethReads\tBloodUnmethReads\tMixMethProportion\tMixMethReads\tMixUnmethReads\ttpMethProportion\ttpMethReads\ttpUnmethReads\tP\tCpGIsland' > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed
echo -e 'Chromosome\tPosition\tPosition2\tSites\tDeconMethProportion\tDeconMethReads\tDeconUnmethReads\tBrainMethProportion\tBrainMethReads\tBrainUnmethReads\tBloodMethProportion\tBloodMethReads\tBloodUnmethReads\tMixMethProportion\tMixMethReads\tMixUnmethReads\ttpMethProportion\ttpMethReads\ttpUnmethReads\tP\tCpGIsland' > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed
echo -e 'Chromosome\tPosition\tPosition2\tSites\tDeconMethProportion\tDeconMethReads\tDeconUnmethReads\tBrainMethProportion\tBrainMethReads\tBrainUnmethReads\tBloodMethProportion\tBloodMethReads\tBloodUnmethReads\tMixMethProportion\tMixMethReads\tMixUnmethReads\ttpMethProportion\ttpMethReads\ttpUnmethReads\tP\tCpGIsland' > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed
echo -e 'Chromosome\tPosition\tPosition2\tSites\tDeconMethProportion\tDeconMethReads\tDeconUnmethReads\tBrainMethProportion\tBrainMethReads\tBrainUnmethReads\tBloodMethProportion\tBloodMethReads\tBloodUnmethReads\tMixMethProportion\tMixMethReads\tMixUnmethReads\ttpMethProportion\ttpMethReads\ttpUnmethReads\tP\tCpGIsland' > /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed

for P in 0 10 20 30 40 50 60 70 80 90 100
do
bedtools intersect -sorted -f 1 -F 1 -wa -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed | uniq >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_iCpG.bed &
bedtools intersect -sorted -f 1 -F 1 -wa -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed | uniq >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.CpG-Island_nCpG.bed &
bedtools intersect -sorted -f 1 -F 1 -wa -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed | uniq >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_iCpG.bed &
bedtools intersect -sorted -f 1 -F 1 -wa -a /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/CorrMethBed/mAbel-BrainMix.Blood-$P.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed -b /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Shared/mAbel-BrainMix.Blood-SharedIslands.deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed | uniq >> /work/mjuswilc/Domain/GreatTits/ultDeconvolution/Mixture/MethylCorreleations/CpG-Islands/Out/mAbel-BrainMix.Blood-AllIslandShared-deduplicated.bismark.deconvoluted-brain-cov.Meth-CpG-Island_nCpG.bed &
wait
done

echo 'CpG Island Methylation Job Complete!!!'
